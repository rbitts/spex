"use strict";

var fs = require('fs');
var M = require('../Schema/mapSchema.js');
var jsonQuery = require('json-query');

let MapProvider = function () {

    var self = this;

    self.__maps;

    self.init = function () {
        return new Promise((resolve, reject) => {
            M.find({})
                .then(D => {
                    self.__maps = D;
                    resolve(D);
                }).catch(reject);
        });
    }

    self.get = function (id) {
        return jsonQuery('[*][id={0}]'.format(id), {
            data: self.__maps,
        }).value;
    }

    self.getByType = function (type) {
        return jsonQuery('[**][*mapTypes={0}]'.format(type), {
            data: self.__maps,
        }).value;
    }


    self.save = function (instance) {
        return new Promise((resolve, reject) => {
            if (instance === null) {
                reject({});
            }
            instance.save(function (err, s) {
                if (err) reject(err);
                resolve(s);
            });
        });
    }
}
module.exports = new MapProvider();